---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';
import type { CollectionEntry } from 'astro:content';

export async function getStaticPaths() {
  const posts = await getCollection('blog');
  return posts
    .filter((p) => !p.data.draft)
    .map((p) => ({ params: { slug: p.slug } }));
}

interface Props {
  slug: string;
}

const { slug } = Astro.params;
const post = (await getCollection('blog')).find((p) => p.slug === slug);
if (!post) return Astro.redirect('/404');
const { Content } = await post.render();
---

<BaseLayout
  title={`${post.data.title} | Angad Singh`}
  description={post.data.description}
>
  <main class="max-w-3xl mx-auto px-6 py-16 sm:py-24">
    <a href="/blog" class="text-muted-gray hover:text-terminal-green text-sm mb-6 inline-block">‚Üê Blog</a>

    <article>
      <header class="mb-8">
        <h1 class="text-2xl sm:text-3xl font-bold text-white tracking-tight mb-2">
          {post.data.title}
        </h1>
        <time class="text-sm text-muted-gray" datetime={post.data.pubDate.toISOString()}>
          {post.data.pubDate.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}
        </time>
      </header>

      <div class="prose prose-invert prose-sm max-w-none
        [&_pre]:bg-charcoal-light [&_pre]:border [&_pre]:border-muted-gray/30 [&_pre]:rounded-lg [&_pre]:p-4 [&_pre]:overflow-x-auto
        [&_code]:text-terminal-green [&_code]:text-sm [&_code]:px-1 [&_code]:rounded
        [&_pre_code]:p-0 [&_pre_code]:bg-transparent
        [&_a]:text-terminal-green [&_a]:hover:underline
        [&_h2]:text-white [&_h2]:text-xl [&_h2]:mt-8 [&_h2]:mb-4
        [&_h3]:text-muted-gray-light [&_h3]:text-lg [&_h3]:mt-6 [&_h3]:mb-3
        [&_p]:text-muted-gray-light [&_p]:leading-relaxed
      ">
        <Content />
      </div>
    </article>
  </main>

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css" integrity="sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV" crossorigin="anonymous" />
</BaseLayout>
